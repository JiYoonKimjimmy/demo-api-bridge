# API Bridge 실제 운영 설정 파일

server:
  port: 10019
  mode: release  # debug, release
  read_timeout: 10s
  write_timeout: 10s
  max_header_bytes: 1048576  # 1MB

log:
  level: info  # debug, info, warn, error
  format: json  # json, console
  output: stdout  # stdout, file
  file_path: ./logs/app.log

# Oracle Database 설정
database:
  host: dev1-db.konadc.com
  port: 15322
  sid: kmdbp19
  username: "map"
  password: "StgMAP1104#"
  max_open_conns: 25
  max_idle_conns: 5
  conn_max_lifetime: 5m
  connection_timeout: 10s
  # 자동 마이그레이션 설정 (기본값: true)
  # development/staging: true (권장)
  # production: 환경 변수로 제어 가능 (export AUTO_MIGRATE=false)
  auto_migrate: true

# Redis Cache 설정 (외부 접근 가능한 Redis 서버) - DEPRECATED
# 현재는 Ristretto 로컬 캐시를 사용합니다.
redis:
  host: dev3.konadc.com
  port: 6379
  password: "123456"
  db: 0
  pool_size: 10
  min_idle_conns: 5
  dial_timeout: 5s
  read_timeout: 3s
  write_timeout: 3s

# 외부 API 설정
external_api:
  base_url: https://api.example.com
  timeout: 30s
  retry_count: 3
  retry_delay: 1s
  max_retry_delay: 10s
  retry_backoff_multiplier: 2.0

# Circuit Breaker 설정
circuit_breaker:
  max_requests: 5
  interval: 10s
  timeout: 5s

# 모니터링
metrics:
  enabled: true
  port: 9090
  path: /metrics

# 캐시 설정 (Ristretto 로컬 캐시)
cache:
  type: local               # local (ristretto), redis, mock
  max_size_mb: 1024         # 1GB 최대 메모리
  num_counters: 10000000    # 10M counters (추정 항목 수의 10배)
  buffer_items: 64          # Get 버퍼 크기
  metrics_enabled: true     # Ristretto 메트릭 활성화
  default_ttl: 300s         # 기본 TTL: 5분
  routing_rules_ttl: 3600s  # 라우팅 규칙 TTL: 1시간
  api_response_ttl: 600s    # API 응답 TTL: 10분

# API 엔드포인트 설정 (메모리 기반, DB 조회 불필요)
endpoints:
  endpoints:
    # Legacy API 엔드포인트
    legacy-api:
      id: legacy-api
      name: Legacy API
      description: Legacy API Information
      base_url: http://dev3.konadc.com:10010
      health_url: /mobile-platform-1.0/api/health
      is_active: true
      is_legacy: true
      is_default: true  # 기본 레거시 엔드포인트로 지정
      timeout: 5s
      retry:
        max_attempts: 3
        initial_delay: 1s
        max_delay: 10s
        backoff_multiplier: 2.0
        retryable_http_codes: [500, 502, 503, 504]

    # Modern API 엔드포인트
    modern-user-api:
      id: modern-api
      name: Modern API
      description: Modern API Information
      base_url: http://dev3.konadc.com:10010  # TODO 추후 변경 예정
      health_url: /mobile-platform-1.0/api/health
      is_active: true
      is_legacy: false
      is_default: true  # 기본 모던 엔드포인트로 지정
      timeout: 3s
      retry:
        max_attempts: 3
        initial_delay: 500ms
        max_delay: 5s
        backoff_multiplier: 2.0
        retryable_http_codes: [500, 502, 503, 504]
